import telebot
import requests
import time
from random import randint as RAND

bot = telebot.TeleBot(
    "5986374571:AAHH-gRgrsbSNig3ZL0GJuzaSloNwF-ol5c", parse_mode=None)

def randomnumber():
    number = int(RAND(1, 1000))
    return number

@bot.message_handler(commands=['start', 'help'])
def send_welcome(our_message):
	bot.reply_to(our_message, "Howdy, how are you doing?")

@bot.message_handler(content_types=['text'])
def greetings(our_message):
    text = (our_message.text).lower()
    
    data = open("logs.txt", mode='a', encoding='utf-8')
    text_logs=f'{our_message.from_user.first_name} {our_message.from_user.last_name}: {our_message.text}\n'
    data.write(text_logs)
    data.close()
    
    if text == "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è":
        data = open("registred_users.txt", mode='a', encoding='utf-8')
        data.write(f"{our_message.from_user.last_name}\n")
        data.close()
        bot.reply
        
        
    # print(f"{our_message}\n")
    # –ø–µ—Ä–µ–≤–æ–¥–∏–º –Ω–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–µ–∫—Å—Ç –∏ –ø–æ–º–µ—â–∞–µ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    
    
    if '–ø—Ä–∏–≤–µ—Ç' in text:
        bot.reply_to(
            our_message, f'–ü—Ä–∏–≤–µ—Ç, {our_message.from_user.first_name}!')

    elif text == '–∫–æ—Ç–∏–∫':
        request = requests.get(f"https://cataas.com/cat?{time.time()}")
        bot.send_photo(our_message.from_user.id, request.content)

    elif text == '–ø–æ–≥–æ–¥–∞':
        request = requests.get('https://wttr.in/?0T')
        bot.reply_to(our_message, request.text)

    elif text == "–∏–≥—Ä–∞":

        bot.reply_to(
            our_message, f'{our_message.from_user.first_name}, –¥–∞–≤–∞–π –ø–æ–∏–≥—Ä–∞–µ–º –≤ –∏–≥—Ä—É!\n–Ø –∑–∞–≥–∞–¥–∞–ª —á–∏—Å–ª–æ, —É–≥–∞–¥–∞–π –µ–≥–æ!\n\n–í–´ –ì–û–¢–û–í–´???ü§†')
    answer = (our_message.text).lower()
    if answer == "–¥–∞":
        bot.reply_to(
            our_message, f'‚úÖ–û—Ç–ª–∏—á–Ω–æ! {our_message.from_user.first_name}, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —á–∏—Å–ª–æüî¢üëá ')
        bot.register_next_step_handler(our_message, game)



def counter(function1):
    def wrap(*args, **kwargs):
        wrap.count_function += 1
        return function1(*args, **kwargs)
    wrap.count_function = 0
    return wrap


number=randomnumber()
@counter
@bot.message_handler(content_types=['text'])
def game(mess):
    
    print(f"–ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ: {number}")  # –≤–∏–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª–∏ –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ
    is_game = True
    while is_game:
        
        text1 = mess.text
        text1 = int(text1)
        
        print(text1)  # –≤–∏–¥–∏–º —á–∏—Å–ª–æ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        
        if text1 > number:

            bot.reply_to(
                mess, f'üîª –£–∫–∞–∂–∏—Ç–µ —á–∏—Å–ª–æ –º–µ–Ω—å—à–µ, {mess.from_user.first_name}!')
            bot.register_next_step_handler(mess, game)
            is_game = False

        if text1 < number:

            bot.reply_to(
                mess, f'üî∫ –£–∫–∞–∂–∏—Ç–µ —á–∏—Å–ª–æ –±–æ–ª—å—à–µ, {mess.from_user.first_name}!')
            bot.register_next_step_handler(mess, game)
            is_game = False
        if int(text1) == number:
            
            msg = bot.reply_to(
                mess, f'üéâüéâüéâ–í–´ –í–´–ò–ì–†–ê–õ–ò, {(mess.from_user.first_name).upper()}!!! –ü–û–ó–î–†–ê–í–õ–Ø–Æ!!!üéâüéâüéâ\n–í—ã —É–≥–∞–¥–∞–ª–∏ –∑–∞ {game.count_function} —Ä–∞–∑!')
            bot.register_next_step_handler(mess, greetings)
            is_game = False



bot.polling()
